# IMPORT_CHECKLIST_v1.6 (ПАПАЖКХ)

Дата: 2026-02-06  
Как пользоваться: напротив каждого пункта ставь ✅ (пройдено) или ❌ (не пройдено) после теста.

---

## IMP-1. Права и режимы

- [ ] IMP-1.1 Guest не может импортировать (кнопка “Импортировать” заблокирована)
- [ ] IMP-1.2 Admin в ALL-mode не может импортировать
- [ ] IMP-1.3 User может импортировать
- [ ] IMP-1.4 Любая запись проходит через Data.ensureWriteOrExplain() / эквивалент

---

## IMP-2. Обязательные колонки

- [ ] IMP-2.1 Начисления: обязателен расчётный месяц (YYYY-MM)
- [ ] IMP-2.2 Начисления: обязательна сумма начисления (число)
- [ ] IMP-2.3 Идентификация: либо UID, либо (ЛС + Фамилия)
- [ ] IMP-2.4 Если обязательных колонок нет — строка ERROR и не импортируется
- [ ] IMP-2.5 Заголовки: если не распознаны — импорт блокируется

---

## IMP-3. Поиск/создание абонента

- [ ] IMP-3.1 Если есть UID → поиск по UID
- [ ] IMP-3.2 Если UID нет → поиск по ЛС+Фамилия
- [ ] IMP-3.3 Если совпадений 0 → “нет абонента” (инфо/ошибка)
- [ ] IMP-3.4 Если совпадений >1 → “неоднозначность” (ошибка)
- [ ] IMP-3.5 Создание абонента возможно только при отсутствии UID и при включённой галочке “разрешить создание”

---

## IMP-4. Начисления

- [ ] IMP-4.1 Нормализация месяца к YYYY-MM
- [ ] IMP-4.2 Повторный импорт начислений за тот же месяц запрещён без “перезапись”
- [ ] IMP-4.3 При “перезапись” строки помечаются OVERWRITE и применяются
- [ ] IMP-4.4 Импорт частичной суммы месяца допускается (без авто-расчёта по дням)

---

## IMP-5. Платежи

- [ ] IMP-5.1 Дата платежа нормализуется к YYYY-MM-DD
- [ ] IMP-5.2 Дата платежа не может быть позже текущей даты
- [ ] IMP-5.3 Дубликаты (дата+сумма+абонент) → SKIP_DUPLICATE
- [ ] IMP-5.4 Ошибочные строки платежей не записываются

---

## IMP-6. Предпросмотр и UX

- [ ] IMP-6.1 Всегда есть предпросмотр до записи
- [ ] IMP-6.2 Итоги: OK / ERROR / CREATED / OVERWRITE / SKIP_DUPLICATE
- [ ] IMP-6.3 “Импортировать” активна только если можно писать и нет критических ошибок
- [ ] IMP-6.4 “Сбросить предпросмотр” очищает результаты

---

## IMP-7. Запрещённые действия при импорте

- [ ] IMP-7.1 Импорт не удаляет данные
- [ ] IMP-7.2 Импорт не чистит базы
- [ ] IMP-7.3 Импорт не меняет тарифы/ставки/реквизиты
- [ ] IMP-7.4 Массовая перезапись только при явной галочке “перезапись”

---
