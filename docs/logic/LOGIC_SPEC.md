# LOGIC_SPEC.md

## CANON TRANSFER v18

### Цель
Обеспечить юридически корректную передачу ответственности по квартире между абонентами
с возможностью переноса задолженности и пени.

### Событие TRANSFER
Сохраняется у ОБОИХ абонентов.

Поля:
- date — дата передачи
- from_abonent_id
- to_abonent_id
- mode — WITH_DEBT | WITHOUT_DEBT
- freeze_to — date - 1 день
- principal — переносимый долг
- penalty — переносимая пеня

### Режимы
#### WITH_DEBT
- Переносится долг и пеня
- Пеня продолжает начисляться у нового абонента
- Старый абонент замораживается

#### WITHOUT_DEBT
- Новый абонент начинает с нуля
- Долг и пеня остаются у старого
- Начисления старому прекращаются

### Расчёт
- Пеня НЕ начисляется старому абоненту после freeze_to
- calc_engine обязан учитывать transfer_balance нового абонента

### Аудит
- История передач обязательна
- События нельзя удалять