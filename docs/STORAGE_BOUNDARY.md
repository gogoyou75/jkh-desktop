# Граница LocalStorage ↔ База данных (ПАПАЖКХ)

Дата фиксации: 2026-02-05

## Цель
Зафиксировать каноническое разделение ответственности между:
- LocalStorage (клиент, офлайн, UI)
- Серверной БД (источник истины, права, история)

Документ обязателен к соблюдению при дальнейшем развитии проекта.

---

## 1. Общий принцип (КАНОН)

**LocalStorage — не база данных.**  
LocalStorage используется как:
- офлайн-хранилище
- кэш
- черновик
- транспортный слой

**База данных — источник истины.**  
БД отвечает за:
- консистентность
- права доступа
- историю изменений

---

## 2. Что хранится в LocalStorage (КЛИЕНТ)

### 2.1. UI и сессия
- текущий пользователь (id, role, email)
- выбранная база / режим просмотра
- фильтры, сортировки, поиск
- состояние меню и вкладок
- позиция скролла

### 2.2. Рабочие данные (офлайн)
- абоненты
- квартиры
- начисления
- платежи
- тарифы
- ставки
- исключённые периоды

⚠️ Эти данные считаются **рабочей копией**, а не юридическим источником.

### 2.3. Черновики и очередь операций
- несинхронизированные изменения
- операции добавления / правки / удаления
- будущая очередь sync → API

### 2.4. Экспорт и бэкапы
- JSON-бэкапы
- снимки состояния на дату
- временные файлы импорта

---

## 3. Что хранится в БД (СЕРВЕР)

### 3.1. Пользователи и права
- users
- roles (guest / user / moderator / admin)
- permissions
- статус пользователя

### 3.2. Основные сущности (источник истины)
- Abonent
- Premises / Apartment
- Payment
- Accrual
- Tariff
- RefinanceRate
- ExclusionPeriod
- Organization

### 3.3. История и аудит
- история изменений
- лог операций
- параметры расчётов
- версии отчётов

### 3.4. Серверные ограничения
- уникальности
- пересечения периодов
- хронология дат
- лимиты (кол-во периодов, длительность)

---

## 4. Архитектурное правило доступа (КРИТИЧЕСКОЕ)

UI **НЕ ОБРАЩАЕТСЯ напрямую** к:
- localStorage
- API

UI работает ТОЛЬКО через слой данных.

